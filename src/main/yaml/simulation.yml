incarnation: protelis

variables:
  Seed: &Seed
    min: 0
    max: 1
    step: 1
    default: 0
  ConnectionDistance: &ConnectionDistance
    formula: 100
  MaxLatitude:
    formula: 44.14795317094557
  MinLatitude: &MinLatitude
    formula: 44.13340676305022
  MaxLongitude:
    formula: 12.267570291912632
  MinLongitude: &MinLongitude
    formula: 12.235568921311268
  LatitudeSpace: &LatitudeSpace
    formula: MaxLatitude - MinLatitude
  LongitudeSpace: &LongitudeSpace
    formula: MaxLongitude - MinLongitude
  PoiCount: &PoiCount
    formula: 15
  MaxTimeInPoi: &MaxTimeInPoi
    formula: 300.0
  SimulationTime: &SimulationTime
    formula: 1800.0
  PeopleWithSmartphoneOnlyPercentage:
    formula: 0.7
  SmartphoneEpi: &SmartphoneEpi
    formula: 0.55 # Joules
  WearableEpi: &WearableEpi
    formula: 0.11 # Joules [Pixel Watch 2 -- Qualcomm SW5100]
  CloudEpi: &CloudEpi
    formula: 10.0 # Joules
  # --------------- Simulation Variables ---------------
  DeviceCount:
    type: ArbitraryVariable
    parameters: [300, [100, 300]]
  PeopleWithSmartphoneAndWearable: &PeopleWithSmartphoneAndWearable
    language: kotlin
    formula: |
      import kotlin.math.floor
      floor(DeviceCount * (1.0 - PeopleWithSmartphoneOnlyPercentage))
  PeopleWithSmartphoneOnly: &PeopleWithSmartphoneOnly
    language: kotlin
    formula: DeviceCount - PeopleWithSmartphoneAndWearable

seeds:
  scenario: *Seed
  simulation: *Seed

network-model:
  type: ConnectWithinDistance
  parameters: [*ConnectionDistance]

_programs:
  configureNextPoi: &configureNextPoi
    - time-distribution: 0.1
      type: Event
      actions:
        - type: ConfigureNextPoi
          parameters: [*MaxTimeInPoi] # max 5 minutes in PoI

  moveToTarget: &moveToTarget
    - time-distribution: 0.5
      type: Event
      actions:
        - type: TargetMapWalker
          parameters: [MovementTarget, 1.4]

  smartphonePulverization: &smartphonePulverization
    - time-distribution: 1.0
      type: Event
      actions:
        - type: PulverizationAction
          parameters: [ ]

  cloudPulverization: &cloudPulverization
    - time-distribution: 1.0
      type: Event
      actions:
        - type: PulverizationCloudAction
          parameters: [ ]

deployments:
  # People with smartphone only
  - type: Rectangle
    parameters: [*PeopleWithSmartphoneOnly, *MinLatitude, *MinLongitude, *LatitudeSpace, *LongitudeSpace]
    programs:
      - *moveToTarget
      - *configureNextPoi
      - *smartphonePulverization
    properties:
      - type: SmartphoneConsumptionModel
        parameters: [*SmartphoneEpi]
    contents:
      - molecule: Person
        concentration: true
  # People with smartphone and wearable
  - type: Rectangle
    parameters: [ *PeopleWithSmartphoneAndWearable, *MinLatitude, *MinLongitude, *LatitudeSpace, *LongitudeSpace ]
    programs:
      - *moveToTarget
      - *configureNextPoi
      - *smartphonePulverization
    properties:
      - type: SmartphoneConsumptionModel
        parameters: [*SmartphoneEpi]
      - type: WearableConsumptionModel
        parameters: [*WearableEpi]
    contents:
      - molecule: Person
        concentration: true
  # Cloud instances
  - type: Point
    parameters: [44.14895317094557, 12.268570291912632]
    properties:
      - type: CloudConsumptionModel
        parameters: [*CloudEpi]
    contents:
      - molecule: CloudInstance
        concentration: true
  # Displace the PoIs into the map
  - type: Rectangle
    parameters: [*PoiCount, *MinLatitude, *MinLongitude, *LatitudeSpace, *LongitudeSpace]
    contents:
      - molecule: PoI
        concentration: true

environment:
  type: OSMEnvironment
  parameters: ["cesena.pbf", true, true]

terminate:
  type: AfterTime
  parameters: *SimulationTime
